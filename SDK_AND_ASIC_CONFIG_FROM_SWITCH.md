# SDK and ASIC Config from Live Switch

**Date**: February 15, 2026  
**Source**: Cumulus switch 10.1.1.233 (AS5610-52X, BCM56846 Trident+)  
**Purpose**: Document actual config files used by switchd/SDK for ASIC control

---

## File Layout

```
/etc/bcm.d/
├── config.bcm          # Merged SDK config (generated)
├── backend_map
├── config.d/
│   ├── 01config.bcm    # Platform overrides (Accton 5610)
│   ├── 02sdk.bcm       # SDK parameters
│   ├── 10phy-ucode.bcm # PHY ucode
│   ├── 11ports.bcm     # Port mapping, port init
│   └── 12portwd.bcm    # (empty)
├── rc.soc              # SOC init script
├── rc.ports_0          # Port env (allports, 10Gports, 40Gports)
├── rc.led
├── rc.phy
├── led0.asm, led0.hex
├── led1.asm, led1.hex
└── datapath/
    ├── datapath.conf   # Buffer/priority group config
    ├── hw_desc         # Hardware description
    └── rc.forwarding   # ECMP hash, CPU punt config

/var/lib/cumulus/
└── rc.datapath_0       # Generated datapath (buffers, regs)

/etc/cumulus/
├── switchd.conf
└── ports.conf         # Port mode (10G/40G per port)
```

---

## 1. config.bcm (Merged)

Generated by `/usr/lib/cumulus/update-ports`. Combines 01, 02, 10, 11, 12.

### SDK Parameters

| Parameter | Value | Purpose |
|-----------|-------|---------|
| polled_irq_mode | 0 | 0=hardware IRQ, 1=polled |
| bcm_stat_flags | 0x1 | Counter DMA |
| l2xmsg_mode | 1 | L2 table: 0=poll, 1=FIFO |
| miim_intr_enable | 1 | MDIO interrupts |
| tdma_intr_enable | 1 | Table DMA interrupts |
| tslam_intr_enable | 1 | SLAM DMA interrupts |
| tslam_dma_enable | 1 | SLAM DMA |
| table_dma_enable | 1 | Table DMA |
| parity_enable | 1 | Parity checking |
| xgxs_lcpll_xtal_refclk | 1 | SerDes reference |
| phy_ext_rom_boot | 0 | MDIO ucode download |

### Port Bitmaps

```
pbmp_xport_xe.0=0x1ffffffffffffe
pbmp_valid.0=0x2001fffffffffffff
```

### Port Map (Logical Port → SerDes Lane : Speed)

Format: `portmap_N.0=physical_lane:speed` (speed 10=10G, 40=40G)

| Port | Lane | Speed | Notes |
|------|------|-------|-------|
| 1-8 | 65-72 | 10 | SFP+ group 1 |
| 9-48 | 5-44 | 10 | SFP+ (some non-sequential) |
| 49 | 49 | 40 | QSFP |
| 50 | 45 | 40 | QSFP |
| 51 | 61 | 40 | QSFP |
| 52 | 57 | 40 | QSFP |

Notable non-sequential mappings: port 21→18, 22→17, 23→20, 24→19, 25→22, 26→21, 27→24, 28→23, 29→25, 30→26.

### Port Init

- `port_init_duplex=1` (full duplex)
- `port_init_speed_xe0` .. `port_init_speed_xe51` = 10000 or 40000
- `port_init_autoneg_xe*` = 0 (no autoneg)

---

## 2. rc.soc

```
debug -PCi -SChan -SOCMEM -SYMTAB -VERInet -L3 -INTr -ARL -ARLMon
debug -L2table -DMA -POrt -PAcket -TX -RCLOAD -TEsts -VERbose -MIIm
debug -PHY -END -LInk -CounTeR -IP -STP -VLAN -RX -I2C -REG -MEM -STK

attach *
0:
init all

rcload /etc/bcm.d/rc.ports_0

setreg xmac_tx_ctrl 0xc802
s MAC_RSV_MASK MASK=0x18

m cmic_misc_control LINK40G_ENABLE=1

0: rcload /var/lib/cumulus/rc.datapath_0

# Trident FP_METER parity errata
setreg IFP_METER_PARITY_CONTROL 0

# RX drop stats
setreg rdbgc0_select 0x04000d11   # RIPD4, RIPD6, RDISC, RPORTD, PDISC, VLANDR
setreg rdbgc3_select 0x00000011   # RIPD4, RIPD6
setreg rdbgc4_select 0x00000100   # RDISC
setreg rdbgc5_select 0x00002000   # RFILDR
setreg rdbgc6_select 0x00008000   # RDROP

# TX drop stats
setreg tdbgc6_select 0x00040000   # TPKTD

rcload /etc/bcm.d/rc.led
```

---

## 3. rc.ports_0

```
setenv allports xe0-xe51
setenv 40Gports xe48-xe51
setenv 10Gports xe0-xe47
```

---

## 4. rc.led

```
led 0 stop
led 0 auto on
led 0 load /etc/bcm.d/led0.hex
led 0 start

led 1 stop
led 1 auto on
led 1 load /etc/bcm.d/led1.hex
led 1 start
```

---

## 5. datapath.conf

### Priority Groups

| Group | ID | Service Pool |
|-------|-----|--------------|
| control | 7 | 1 |
| service | 2 | 2 |
| lossless | 3 | 3 |
| bulk | 0 | 0 |

### Ingress Buffer

- ingress_service_pool.0.percent = 0.0 (bulk)
- ingress_service_pool.1.percent = 3.0 (control)
- ingress_service_pool.2.percent = 2.0 (service)
- ingress_service_pool.3.percent = 1.0 (lossless)

### Egress Buffer

- egress_service_pool.0.percent = 45.0 (bulk)
- egress_service_pool.1..3.percent = 90.0

### CoS → Queue

- cos_egr_queue.cos_0..7: uc/cpu = 0..7

### DoS Prevention

All DoS checks disabled (sip_eq_dip, smac_eq_dmac, tcp_*, udp_*, icmp_*, etc. = false).

---

## 6. hw_desc

```
hardware.total_buffer_cells = 46080
hardware.cell_bytes = 208
hardware.max_frame_cells = 45
hardware.num_priorities = 16
hardware.num_priority_groups = 8
hardware.num_service_pools = 4
hardware.num_mc_queues = 4
```

---

## 7. rc.forwarding

### RTAG7 ECMP Hashing

- RTAG7 hash bins: rpid, sip[31:16], sip[15:0], dip[31:16], dip[15:0], vlan, l4_sport, l4_dport, protocol, src_portid, src_modid, dst_portid, dst_modid
- IPv4/IPv6 TCP/UDP: bins 2,3,4,5,6,8,9,10,11
- hash_a0_function_select=9 (CRC16-CCITT)
- rtag7_hash_seed_a = 42
- ecmp_hash_use_rtag7=1
- use_tcp_udp_ports=1
- l3_hash_select=4
- non_uc_trunk_hash_use_rtag7=1

### CPU Punt

- l3_mtu_fail_tocpu=1
- l3_slowpath_tocpu=1
- v4l3dstmiss_tocpu=1
- v6l3dstmiss_tocpu=1

### L2

- l2_mod_fifo_enable_l2_delete=0 (avoids mod fifo overflow)

---

## 8. rc.datapath_0 (Excerpt)

### Buffer Allocation

- total mem cells: 46080
- service pool 0: 0 (ingress), 20736 (egress)
- service pool 1: 1382 (ingress), 41472 (egress)
- service pool 2: 921 (ingress), 41472 (egress)
- service pool 3: 0 (ingress), 135 (egress)

### Commands

- modreg, setreg, write, modify for ingress/egress buffers, priority mapping, flow control
- port ranges: xe0-xe47 (10G), xe48-xe51 (40G), cpu0

---

## 9. backend_map

```
backend index list:
backend 0
```

---

## 10. switchd.conf

Active setting:
```
logging = file:/var/log/switchd.log=INFO
```

Other options (commented): stats.poll_interval, route.table, coalescing, netlink.buf_size, etc.

---

## 11. ports.conf

Platform: accton,as5610_52x
- Ports 1-48: SFP+, configurable 10G or 4×10G
- Ports 49-52: QSFP, configurable 40G or 4×10G

All ports set to 10G (1-48) or 40G (49-52).

---

## Port Map Summary (Logical → Physical)

| swp | xe | SerDes Lane | Speed |
|-----|-----|-------------|-------|
| swp1 | xe0 | 65 | 10G |
| swp2 | xe1 | 66 | 10G |
| ... | ... | ... | ... |
| swp8 | xe7 | 72 | 10G |
| swp9 | xe8 | 5 | 10G |
| ... | ... | ... | ... |
| swp48 | xe47 | 44 | 10G |
| swp49 | xe48 | 49 | 40G |
| swp50 | xe49 | 45 | 40G |
| swp51 | xe50 | 61 | 40G |
| swp52 | xe51 | 57 | 40G |

---

## References

- bcm-config-format.md – .bcm syntax
- config-to-register-map.md – setreg mapping
- ASIC_INIT_AND_DMA_MAP.md – init flow
