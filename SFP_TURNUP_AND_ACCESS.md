# SFP Turn-Up, Access, and Testing

**Date**: February 15, 2026  
**Platform**: Accton AS5610-52X (Edgecore AS5610-52X)  
**Source**: Live tests on Cumulus switch <LIVE_SWITCH_IP>

---

## Summary

| Component | Path | Notes |
|-----------|------|-------|
| **sfptab** | `/var/lib/cumulus/sfptab` | Maps `swpN` → eeprom sysfs path |
| **eeprom_dev** | `/sys/class/eeprom_dev/eepromX/device/eeprom` | Kernel class; `label` = `portN` |
| **I2C** | `i2c-N/MM-0050` | Port1 → i2c-22/0x50; swpN → eeprom(N+6) |
| **ethtool -m** | `ethtool -m swpN` | Reads SFP/QSFP EEPROM via kernel ioctl |

---

## 1. sfptab

**Location**: `/var/lib/cumulus/sfptab`  
**Generated by**: `/usr/lib/cumulus/update-ports`

**Format** (tab-separated):
```
linux_intf	mode	sfp_addrtype	sfp_addr
swp1	sfp+	dts-sysfs	/sys/class/eeprom_dev/eeprom7/device/eeprom
swp2	sfp+	dts-sysfs	/sys/class/eeprom_dev/eeprom8/device/eeprom
...
```

**Lookup** (get eeprom path for swp1):
```bash
grep "^swp1	" /var/lib/cumulus/sfptab | awk '{print $4}'
# Output: /sys/class/eeprom_dev/eeprom7/device/eeprom
```

---

## 2. eeprom_dev Layout

| swpN | eeprom_dev | label | I2C (example) |
|------|------------|-------|---------------|
| swp1 | eeprom7 | port1 | i2c-22 / 0x50 |
| swp2 | eeprom8 | port2 | i2c-23 / 0x50 |
| swp3 | eeprom9 | port3 | i2c-24 / 0x50 |
| swp22 | eeprom28 | port22 | ... |
| swp48 | eeprom54 | port48 | ... |
| swp49 | eeprom55 | port49 | ... |

**Rule**: `swpN` → `eeprom(N+6)` with `label = portN`.

**Resolve to I2C path**:
```bash
readlink -f /sys/class/eeprom_dev/eeprom7/device/eeprom
# /sys/devices/soc.0/ff703100.i2c/i2c-1/i2c-10/i2c-22/22-0050/eeprom
```
→ swp1 uses I2C bus `i2c-22`, device address `0x50`.

---

## 3. SFP EEPROM Byte Layout (A0h)

| Offset | Size | Content | Example (swp1) |
|--------|------|---------|----------------|
| 0 | 1 | Identifier (0x03=SFP, 0x0d=QSFP) | 0x03 |
| 1 | 1 | Extended identifier | 0x04 |
| 2 | 1 | Connector | 0x07 (LC) |
| 3–10 | 8 | Transceiver codes | 0x20 0x00 ... |
| 20–35 | 16 | Vendor name | "FINISAR CORP.   " |
| 40–55 | 16 | Vendor PN | "FTLX1475D3BTL-E7A" |
| 68–83 | 16 | Vendor serial | "XA0BAJGQ" etc. |
| 84–91 | 8 | Date code | "180912" |

---

## 4. Test Commands and Results

### 4.1 Read sfptab
```bash
cat /var/lib/cumulus/sfptab | head -10
```
```
# Automatically generated by /usr/lib/cumulus/update-ports.
# Fri Nov  1 12:08:49 2013
# Do not edit.
# linux_intf	mode	sfp_addrtype	sfp_addr
swp1	sfp+	dts-sysfs	/sys/class/eeprom_dev/eeprom7/device/eeprom
swp2	sfp+	dts-sysfs	/sys/class/eeprom_dev/eeprom8/device/eeprom
...
```

### 4.2 Direct EEPROM read (swp1)
```bash
hexdump -C /sys/class/eeprom_dev/eeprom7/device/eeprom | head -10
```
```
00000000  03 04 07 20 00 00 00 12  00 01 40 06 67 00 0a 64  |... ......@.g..d|
00000010  00 00 00 00 46 49 4e 49  53 41 52 20 43 4f 52 50  |....FINISAR CORP|
00000020  2e 20 20 20 00 00 90 65  46 54 4c 58 31 34 37 35  |.   ...eFTLX1475|
00000030  44 33 42 54 4c 2d 45 37  41 20 20 20 05 1e 00 14  |D3BTL-E7A   ....|
...
```

### 4.3 ethtool -m swp1
```bash
ethtool -m swp1
```
```
	Identifier                                : 0x03 (SFP)
	Extended identifier                       : 0x04 (GBIC/SFP defined by 2-wire interface ID)
	Connector                                 : 0x07 (LC)
	Transceiver codes                         : 0x20 0x00 0x00 0x00 0x12 0x00 0x01 0x40
	Transceiver type                          : 10G Ethernet: 10G Base-LR
	...
	Vendor name                               : FINISAR CORP.   
	Vendor OUI                                : 00:90:65
	Vendor PN                                 : FTLX1475D3BTL-E7
	Vendor rev                                : A   
	...
	Module temperature                        : 12.80 degrees C / 55.04 degrees F
	Module voltage                            : 3.3323 V
```

### 4.4 Cross-check: Byte 0
```bash
dd if=/sys/class/eeprom_dev/eeprom7/device/eeprom bs=1 count=1 2>/dev/null | hexdump -C
```
```
00000000  03                                                |.|
```
→ Matches ethtool Identifier 0x03 (SFP).

### 4.5 Vendor/PN from hex
Bytes 20–35: `46 49 4e 49 53 41 52 20 43 4f 52 50 2e 20 20 20` → "FINISAR CORP.   "  
Bytes 40–55: `46 54 4c 58 31 34 37 35 44 33 42 54 4c 2d 45 37 41` → "FTLX1475D3BTL-E7A"

---

## 5. Data Flow

1. **ethtool -m swp1**  
   - Uses `SIOCETHTOOL` ioctl with `ETHTOOL_GMODULEINFO` / `ETHTOOL_GMODULEEEPROM`  
   - Kernel maps `swp1` → eeprom via netlink or swp→port mapping  
   - Kernel reads from `/sys/class/eeprom_dev/eeprom7/device/eeprom` (or equivalent I2C path)

2. **Direct sysfs read**  
   - Same backing storage as ethtool  
   - `hexdump -C /sys/class/eeprom_dev/eeprom7/device/eeprom` returns raw EEPROM

3. **sfptab**  
   - User-space lookup: `swpN` → eeprom path  
   - Used by Cumulus tools (e.g. `update-ports`, platform scripts)

---

## 6. I2C Topology

- SFP ports 1–48: Each port typically on its own I2C mux segment (i2c-22..i2c-69 or similar).
- QSFP ports 49–52: Separate I2C buses; layout platform-specific.
- Base I2C controller: `soc.0/ff703100.i2c` with mux `i2c-10` branching to port buses.

---

## 7. References

- PLATFORM_ENVIRONMENTAL_AND_PSU_ACCESS.md – I2C, CPLD, hwmon
- SFF-8472 (SFP), SFF-8636 (QSFP) – EEPROM layouts
- Cumulus: `/usr/lib/cumulus/update-ports`, `cumulus/sfp.py` (SFPROMDTSLabel)
